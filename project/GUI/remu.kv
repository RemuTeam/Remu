ScreenManager:
    id: screen_manager
    SwitchLayout:
        id: switch_layout
        manager: screen_manager
    MasterGUILayout:
        label_text: switch_layout.text
        manager: screen_manager
    SlaveGUILayout:
        manager: screen_manager


<SwitchLayout>:
    name: 'switch_layout'
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: "Choose master or slave"
        BoxLayout:
            orientation: 'horizontal'
            Button:
                text: "Master"
                size_hint: 0.3,0.3
                on_press: app.set_master()
                on_press: app.add_slave("127.0.0.1")
                on_press: root.add_address("127.0.0.1")
                on_release: app.root.current = 'master_gui_layout'
            Button:
                text: "Slave"
                size_hint: 0.3,0.3
                on_press: app.set_slave()
                on_release: app.root.current = 'slave_gui_layout'


<MasterGUILayout>:
    id: master_gui_layout
    name: 'master_gui_layout'
    messages_sent: msg_sent_amount
    orientation: 'vertical'
    spacing: 10
    padding: 10

    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            #name: "options"
            orientation: 'horizontal'
            size_hint: 1, 0.1
            Button:
                text: "Send message to slave"
                on_press: app.send_msg("127.0.0.1", "Mooooi!")
                on_press: msg_sent_amount.text = root.increment()
            Button:
                text: "Back"
                on_press: root.show_popup()
            TextInput:
                id: txt_input
                hint_text: "0.0.0.0:8000"
            Button:
                text: "Add Slave"
                on_press: app.close_connections()
                on_press: app.add_slave(txt_input.text)
                on_press: root.set_address(txt_input.text)
        BoxLayout:
            #name: "middle"
        BoxLayout:
            #name: "bottom_panel"
            orientation: 'horizontal'
            size_hint: 1, 0.1
            Label:
                text: root.label_text
            Label:
                text: "Messages sent: "
            Label:
                id: msg_sent_amount
                text: "0"



<SlaveGUILayout>:
    name: "slave_gui_layout"
    orientation: 'vertical'
    spacing: 10
    padding: 10

    BoxLayout:
        orientation: 'vertical'
        Label:
            text: "Currently in slave mode"
            font_size: 32
        Image:
            id: picture
            source: None
        Button:
            text: "Simulate master signal"
            on_press: root.button_pressed()

<Popp>:
    title: "Are you sure you want to go back?"
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: "If you answer yes, the connection with all slaves will be lost."
        BoxLayout:
            orientation: 'horizontal'
            Button:
                text: "Yes"
                on_press: app.close_connections()
                on_press: root.dismiss()
                on_release: app.root.current = 'switch_layout'
                size_hint: 0.3,0.3
            Button:
                text: "No"
                on_press: root.dismiss()
                size_hint: 0.3,0.3